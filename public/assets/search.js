// Generated by CoffeeScript 2.4.1
(function() {
  //						XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest
  var API, SearchResults;

  SearchResults = class SearchResults {
    constructor(word1, usages) {
      this.word = word1;
      this.usages = usages;
    }

    toHtml() {
      var example, highLightWord, i, len, ref, results1;
      highLightWord = function(str, word) {
        return str.replace(new RegExp(`(${word})`, 'gi'), '<strong>$1</strong>');
      };
      ref = this.usages;
      results1 = [];
      for (i = 0, len = ref.length; i < len; i++) {
        example = ref[i];
        results1.push(`<p>${highLightWord(example, this.word)}</p>`);
      }
      return results1;
    }

    isEmpty() {
      return this.usages.length === 0;
    }

  };

  API = class API {
    search(keyword, callback) {
      var xhr;
      xhr = new XMLHttpRequest;
      xhr.open("GET", `http://localhost:8080/api/get-word-usages/${encodeURI(keyword)}`, true);
      xhr.onreadystatechange = function() {
        var response, results;
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            response = JSON.parse(xhr.responseText);
            results = response.usages;
            return callback(new SearchResults(response.word, response.usages));
          } else {
            console.log('no gain no pain');
            return $('wiki-examples').innerHTML = `ERROR: ${xhr.responseText}`;
          }
        }
      };
      return xhr.send(null);
    }

  };

  this.$ = function(id) {
    return document.getElementById(id);
  };

  this.doSearch = function() {
    var appender, word;
    word = $("searchQuery").value;
    appender = function(data) {
      if (!data.isEmpty()) {
        $('wiki-examples').innerHTML = '';
        return data.toHtml().forEach(function(x) {
          return $('wiki-examples').innerHTML += `${x}`;
        });
      } else {
        return $('wiki-examples').innerHTML = 'no results';
      }
    };
    if (!!word) {
      $('wiki-examples').innerHTML = 'searching ...';
      return (new API).search(word, appender);
    } else {
      return $('wiki-examples').innerHTML = '';
    }
  };

  // search = new API
// search.search('reload', (x) -> console.log x.toHtml())

}).call(this);
